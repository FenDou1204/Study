# IPv6知识点

## 标准文档
- RFC1883 IPv6协议本身
- RFC1884 IPv6地址结构
- RFC1885
- RFC2236

## IPv6包头结构

### 数据包基本结构

	| 版本 |  业务流类别 | 流标签 |
	| 净荷长度 |下一个头 | 跳极限 |
	|     流源IP地址            |
	|	  流目的IP地址           |
	|	  数据包的数据部分        |
	|     净荷                   |

### 数据包字段说明

|-|-|-|-|
|选项|长度(位)|值|作用|
|**版本**|4|6|说明IP版本|
|类别|8|默认值都为0|区分服务？|
|流标签|20（4字节）|1|标识属于同一业务流包|
|净荷长度|16||IPv6头后包的字节数|
|下一个头|8||指明是TCP还是UDP或者其他扩展头|
|跳极限|8（8字节）||转发减1|
|源IP地址|128（24字节）||指明源IP|
|目的IP地址|128（40字节）||指明目的IP|

#### ipv6重要的一些概念
- **IPv6头部一共为40字节**
- **IPv6的分段只能由源节点和目的节点进行**
- **IPv6标准中强烈推荐所有IPv6节点都支持路径MTU发，能够发现整个传输路径所经设备支持转发数据包的最大长度**

## ICMPv6

### 作用
1. 报告错误和信息状态
2. ping功能和追踪路由功能

### 错误说明
- 目的不可达
 1. 0:无到目的地路由
 2. 1：通信被管理员禁止
 3. 2：不是邻居
 4. 3：地址不可达
 5. 4：端口不可达 
- 包太长
 1. 路由器判断数据包太长超过MTU
- 超时
 1. 路由器收到跳极限为1的数据包时，转发此包设置为0，会返回超时错误
- 参数问题
 1. ipv6头或者扩展头参数有问题，路由器丢弃此包，产生相应错误信息的icmp包
- 回声请求
 1. icmpv6请求
- 回声应答
 1. icmpv6应答

## IPv6地址

IPv6地址为128位，共16字节，分为8组，每组4个十六进制数表示。

### IPv6地址分类

- 单播
- 组播
- 泛播

### IPv6地址分类

|-|-|-|
|IPv6地址分类|前缀|占比|
|保留|0000 0000(00)|1/256|
|未分配|0000 0001(01)|1/256|
|为NSAP分配保留|0000 001(02-03)|1/128|
|为IPX分配保留|0000 010(04-05)|1/128|
|未分配|0000 011(06-07)||
|未分配|0000 1(08-0F)||
|未分配|0001(10-1F)||
|**可集聚全球单播地址**|001(20-3F)|1/8|
|未分配|010(40-5F)|1/8|
|未分配|011(60-7F)|1/8|
|未分配|100(80-9F)|1/8|
|未分配|101(A0-BF)|1/8|
|未分配|110(C0-DF)|1/8|
|未分配|1110(E0-EF)|1/16|
|未分配|1111 0(F0-F7)|1/32|
|未分配|1111 10(F8-FB)|1/64|
|未分配|1111 110(FC-FD)|1/128|
|未分配|1111 1110 0(FE0-FE7)|1/512|
|**链路本地单播地址**|1111 1110 10(FE8-FEB)|1/1024|
|**站点本地单播地址**|1111 1110 11(FEC-FEF)|1/1024|
|**组播地址**|1111 1111(FF)|1/256|